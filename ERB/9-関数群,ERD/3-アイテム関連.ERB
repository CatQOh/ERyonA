@アイテムDT作成
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC LCOUNT2
{
#DIMS DYNAMIC DTNAME =
"アイテム",
"アイテム一覧",
}
{
#DIMS DYNAMIC COLUMNNAME = 
"名前",
"レア度",
"装備中",
"装備手",
"所有部隊",
"耐久値",
"分類",
"攻撃力",
"防御力",
"命中率",
"特殊効果",
"重量",
"必要筋力",
"必要耐久",
"必要知性",
"必要器用",
"必要感覚",
"必要運勢",
"対象無し",
"説明",
}

FOR LCOUNT, 0, VARSIZE("DTNAME")
	DT_CREATE DTNAME:LCOUNT
	SIF !RESULT
		CONTINUE
	FOR LCOUNT2, 0, VARSIZE("COLUMNNAME")
		SELECTCASE COLUMNNAME:LCOUNT2
			CASE "名前", "分類", "特殊効果", "説明", "装備手"
				DT_COLUMN_ADD DTNAME:LCOUNT, COLUMNNAME:LCOUNT2, "string"
			CASE "装備中"
				DT_COLUMN_ADD DTNAME:LCOUNT, COLUMNNAME:LCOUNT2, "int64"
			CASE "耐久値", "重量"
				DT_COLUMN_ADD DTNAME:LCOUNT, COLUMNNAME:LCOUNT2, "int16"
			CASEELSE
				DT_COLUMN_ADD DTNAME:LCOUNT, COLUMNNAME:LCOUNT2, "int8"
		ENDSELECT
	NEXT
NEXT

@アイテム一覧
;テンプレ
;{
;DT_ROW_ADD "武器", "名前", "", "レア度", , "耐久値", , "分類", "",
;"攻撃力", , "防御力", , "命中率", , "特殊効果", "", "重量", ,
;"必要筋力", , "必要耐久", , "必要知性", , "必要器用", , "必要感覚", , "必要運勢", ,
;"説明", ""
;}
{
DT_ROW_ADD "アイテム一覧", "名前", "ショートソード", "レア度", 1, "耐久値", 30, "分類", "剣",
"攻撃力", 3, "命中率", 90, "重量", 3,
"説明", "軽くて扱いやすい短剣"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "ロングソード", "レア度", 2, "耐久値", 50, "分類", "剣",
"攻撃力", 5, "命中率", 80, "重量", 7,
"必要筋力", 2,
"説明", "戦闘向けの両刃の剣"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "レイピア", "レア度", 3, "耐久値", 20, "分類", "剣",
"攻撃力", 4, "命中率", 95, "特殊効果", "回避率上昇*10", "重量", 3,
"必要器用", 3,
"説明", "脆いが非常に軽く、かつ鋭利な剣"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "刀", "レア度", 6, "耐久値", 50, "分類", "剣",
"攻撃力", 7, "命中率", 90, "重量", 5,
"必要筋力", 2, "必要器用", 3, "必要感覚", 3,
"説明", "切れ味を追求した攻撃力の高い片刃の剣"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "ハンドアックス", "レア度", 1, "耐久値", 50, "分類", "斧",
"攻撃力", 5, "命中率", 60, "重量", 10,
"必要筋力", 4,
"説明", "伐採用の手斧。重くて取り回しが悪い"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "バトルアックス", "レア度", 3, "耐久値", 100, "分類", "斧",
"攻撃力", 8, "命中率", 50, "重量", 20,
"必要筋力", 8,
"説明", "破壊的な戦闘用の斧"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "ピストル", "レア度", 2, "耐久値", 30, "分類", "銃",
"攻撃力", 5, "命中率", 70, "重量", 5,
"必要器用", 3,
"説明", "扱いやすい拳銃"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "ライフル", "レア度", 4, "耐久値", 50, "分類", "銃",
"攻撃力", 7, "命中率", 80, "重量", 10,
"必要器用", 8,
"説明", "火力と命中率を高めた単発銃"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "散弾銃", "レア度", 4, "耐久値", 30, "分類", "銃",
"攻撃力", 10, "命中率", 50, "重量", 15,
"必要筋力" , 4, "必要器用", 6, "必要感覚", 4,
"説明", "一発の威力に重きを置いた銃"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "バックラー", "レア度", 1, "耐久値", 30, "分類", "盾",
"防御力", 3, "重量", 3,
"必要耐久", 1,
"説明", "簡素な作りの小さい盾"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "シールド", "レア度", 3, "耐久値", 100, "分類", "盾",
"防御力", 7, "重量", 10,
"必要筋力", 2, "必要耐久", 4,
"説明", "堅牢な作りの中型の盾"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "タワーシールド", "レア度", 5, "耐久値", 200, "分類", "盾",
"防御力", 15, "重量", 25,
"必要筋力", 5, "必要耐久", 10,
"説明", "背丈ほどもある巨大な厚い盾"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "ワンド", "レア度", 1, "耐久値", 50, "分類", "杖",
"攻撃力", 2, "命中率", 90, "重量", 3,
"必要知性", 2,
"説明", "微弱な魔力が宿った木製の杖"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "錫杖", "レア度", 5, "耐久値", 100, "分類", "杖",
"攻撃力", 5, "命中率", 90, "特殊効果", "運勢上昇+2", "重量", 5,
"必要知性", 6, "必要感覚", 4,
"説明", "神の加護が得られる金属製の杖"
}

{
DT_ROW_ADD "アイテム一覧", "名前", "ローブ", "レア度", 1, "耐久値", 10, "分類", "防具",
"防御力", 1, "特殊効果", "回避率上昇+5", "重量", 1,
"説明", "戦闘には適さない布の服。軽さだけが取り柄"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "レザーアーマー", "レア度", 1, "耐久値", 30, "分類", "防具",
"防御力", 3, "重量", 3,
"必要耐久", 1,
"説明", "多少の攻撃なら通さない革製の鎧"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "スケイルアーマー", "レア度", 2, "耐久値", 50, "分類", "防具",
"防御力", 5, "重量", 7,
"必要筋力", 1, "必要耐久", 2,
"説明", "防御力と軽さのバランスが取れた鎧"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "チェインメイル", "レア度", 3, "耐久値", 70, "分類", "防具",
"防御力", 7, "重量", 10,
"必要筋力", 3, "必要耐久", 5,
"説明", "並の攻撃は通さない重量級の鎧"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "プレートアーマー", "レア度", 4, "耐久値", 100, "分類", "防具",
"防御力", 10, "重量", 15,
"必要筋力", 5, "必要耐久", 7,
"説明", "非常に重く非常に堅牢な鎧"
}

{
DT_ROW_ADD "アイテム一覧", "名前", "三角帽子", "レア度", 2, "耐久値", 30, "分類", "頭装備",
"防御力", 1, "特殊効果", "魔法増強+1", "重量", 1,
"必要知性", 2,
"説明", "魔法の威力を高める帽子"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "ヘルメット", "レア度", 2, "耐久値", 50, "分類", "頭装備",
"防御力", 2, "重量", 2,
"必要耐久", 1,
"説明", "防御力に貢献できる頭装備"
}

{
DT_ROW_ADD "アイテム一覧", "名前", "サンダル", "レア度", 1, "耐久値", 30, "分類", "足装備",
"防御力", 1, "重量", 1,
"説明", "裸足よりはマシな装備"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "ブーツ", "レア度", 2, "耐久値", 50, "分類", "足装備",
"防御力", 2, "重量", 1,
"必要耐久", 1,
"説明", "足元の安定性を高めてくれる靴"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "護符", "レア度", 4, "耐久値", 100, "分類", "アクセサリ",
"特殊効果", "状態異常回避+5", "重量", 1,
"必要感覚", 3,
"説明", "あらゆる状態異常を低確率で回避できる護符"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "身代りの護符", "レア度", 10, "耐久値", 1, "分類", "アクセサリ",
"特殊効果", "致命傷回避", "重量", 1,
"必要運勢", 8,
"説明", "一度だけ致命傷を無効化する護符"
}

{
DT_ROW_ADD "アイテム一覧", "名前", "回復薬", "レア度", 1, "耐久値", 1, "分類", "消耗品",
"特殊効果", "HP回復+2", "重量", 1,
"説明", "HPを回復できる薬"
}
{
DT_ROW_ADD "アイテム一覧", "名前", "水晶", "レア度", 1, "耐久値", 1, "分類", "消耗品",
"特殊効果", "MP回復+2", "重量", 1,
"説明", "魔力が宿った石。砕くことでMPを回復できる"
}


;;;指定した名前のアイテムを追加する
@アイテム追加, 武器名, 補正値
#DIMS DYNAMIC 武器名
#DIM DYNAMIC 補正値
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC ROWIDFROM
#DIM DYNAMIC ROWIDTO
{
#DIMS DYNAMIC COLUMNNAME = 
"名前",
"レア度",
"装備中",
"耐久値",
"分類",
"攻撃力",
"防御力",
"命中率",
"特殊効果",
"重量",
"必要筋力",
"必要耐久",
"必要知性",
"必要器用",
"必要感覚",
"必要運勢",
"対象無し",
"説明",
}

FOR LCOUNT, 0, DT_ROW_LENGTH("アイテム一覧")
	IF DT_CELL_GETS("アイテム一覧", LCOUNT, "名前") == 武器名
		ROWIDFROM = LCOUNT
		BREAK
	ENDIF
NEXT

DT_ROW_ADD "アイテム"
ROWIDTO = DT_ROW_LENGTH("アイテム")-1

FOR LCOUNT, 0, VARSIZE("COLUMNNAME")
	SIF DT_CELL_ISNULL("アイテム一覧", ROWIDFROM, COLUMNNAME:LCOUNT)
		CONTINUE
	SELECTCASE DT_COLUMN_EXIST("アイテム一覧", COLUMNNAME:LCOUNT)
		CASE 5
			DT_CELL_SET "アイテム", ROWIDTO, COLUMNNAME:LCOUNT, DT_CELL_GETS("アイテム一覧", ROWIDFROM, COLUMNNAME:LCOUNT)
		CASEELSE
			DT_CELL_SET "アイテム", ROWIDTO, COLUMNNAME:LCOUNT, DT_CELL_GET("アイテム一覧", ROWIDFROM, COLUMNNAME:LCOUNT)
	ENDSELECT
NEXT

RETURN

;;;指定したアイテムIDがどの部隊のものでもない（拠点で扱えるフリーなものか）を判別する
@拠点アイテム, ITEMID
#FUNCTION
#DIM DYNAMIC ITEMID

SIF DT_CELL_GETS("アイテム", ITEMID, "名前") == ""
	RETURNF 0

RETURNF (DT_CELL_ISNULL("アイテム", ITEMID, "所有部隊") || DT_CELL_GET("アイテム", ITEMID, "所持部隊") == 0) && (DT_CELL_ISNULL("アイテム", ITEMID, "装備中") || DT_CELL_GET("アイテム", ITEMID, "装備中") == 0)

@アイテム名, ITEMID
#FUNCTIONS
#DIM DYNAMIC ITEMID

RETURNF DT_CELL_GETS("アイテム", ITEMID, "名前")

@レア度, ITEMID
#FUNCTION
#DIM DYNAMIC ITEMID

RETURNF DT_CELL_GET("アイテム", ITEMID, "レア度")

@装備中, ITEMID
#FUNCTION
#DIM DYNAMIC ITEMID

SIF DT_CELL_ISNULL("アイテム", ITEMID, "装備中")
	RETURNF 0
RETURNF DT_CELL_GET("アイテム", ITEMID, "装備中")

@装備手, ITEMID
#FUNCTIONS
#DIM DYNAMIC ITEMID

SIF DT_CELL_ISNULL("アイテム", ITEMID, "装備手")
	RETURNF ""
RETURNF DT_CELL_GETS("アイテム", ITEMID, "装備手")

@所有部隊, ITEMID
#FUNCTION
#DIM DYNAMIC ITEMID

SIF DT_CELL_ISNULL("アイテム", ITEMID, "所有部隊")
	RETURNF 0
RETURNF DT_CELL_GET("アイテム", ITEMID, "所有部隊")

@耐久値, ITEMID
#FUNCTION
#DIM DYNAMIC ITEMID

SIF DT_CELL_ISNULL("アイテム", ITEMID, "耐久値")
	RETURNF 0
RETURNF DT_CELL_GET("アイテム", ITEMID, "耐久値")

@分類, ITEMID
#FUNCTIONS
#DIM DYNAMIC ITEMID

SIF DT_CELL_ISNULL("アイテム", ITEMID, "分類")
	RETURNF ""
RETURNF DT_CELL_GETS("アイテム", ITEMID, "分類")

@攻撃力, ITEMID
#FUNCTION
#DIM DYNAMIC ITEMID

SIF DT_CELL_ISNULL("アイテム", ITEMID, "攻撃力")
	RETURNF 0
RETURNF DT_CELL_GET("アイテム", ITEMID, "攻撃力")

@防御力, ITEMID
#FUNCTION
#DIM DYNAMIC ITEMID

SIF DT_CELL_ISNULL("アイテム", ITEMID, "防御力")
	RETURNF 0
RETURNF DT_CELL_GET("アイテム", ITEMID, "防御力")

@命中率, ITEMID
#FUNCTION
#DIM DYNAMIC ITEMID

SIF DT_CELL_ISNULL("アイテム", ITEMID, "命中率")
	RETURNF 0
RETURNF DT_CELL_GET("アイテム", ITEMID, "命中率")

@特殊効果, ITEMID
#FUNCTIONS
#DIM DYNAMIC ITEMID

SIF DT_CELL_ISNULL("アイテム", ITEMID, "特殊効果")
	RETURNF ""
RETURNF DT_CELL_GETS("アイテム", ITEMID, "特殊効果")

@重量, ITEMID
#FUNCTION
#DIM DYNAMIC ITEMID

SIF DT_CELL_ISNULL("アイテム", ITEMID, "重量")
	RETURNF 0
RETURNF DT_CELL_GET("アイテム", ITEMID, "重量")

@要求ステータス, ITEMID, 要求ステータス
#FUNCTION
#DIM DYNAMIC ITEMID
#DIMS DYNAMIC 要求ステータス

SELECTCASE 要求ステータス
	CASE "必要筋力", "筋力"
		SIF DT_CELL_ISNULL("アイテム", ITEMID, "必要筋力")
			RETURNF 0
		RETURNF DT_CELL_GET("アイテム", ITEMID, "必要筋力")
	CASE "必要耐久", "耐久"
		SIF DT_CELL_ISNULL("アイテム", ITEMID, "必要耐久")
			RETURNF 0
		RETURNF DT_CELL_GET("アイテム", ITEMID, "必要耐久")
	CASE "必要知性", "知性"
		SIF DT_CELL_ISNULL("アイテム", ITEMID, "必要知性")
			RETURNF 0
		RETURNF DT_CELL_GET("アイテム", ITEMID, "必要知性")
	CASE "必要器用", "器用"
		SIF DT_CELL_ISNULL("アイテム", ITEMID, "必要器用")
			RETURNF 0
		RETURNF DT_CELL_GET("アイテム", ITEMID, "必要器用")
	CASE "必要感覚", "感覚"
		SIF DT_CELL_ISNULL("アイテム", ITEMID, "必要感覚")
			RETURNF 0
		RETURNF DT_CELL_GET("アイテム", ITEMID, "必要感覚")
	CASE "必要運勢", "運勢"
		SIF DT_CELL_ISNULL("アイテム", ITEMID, "必要運勢")
			RETURNF 0
		RETURNF DT_CELL_GET("アイテム", ITEMID, "必要運勢")
ENDSELECT

@対象無し, ITEMID
#FUNCTION
#DIM DYNAMIC ITEMID

SIF DT_CELL_ISNULL("アイテム", ITEMID, "対象無し")
	RETURNF 0
RETURNF DT_CELL_GET("アイテム", ITEMID, "対象無し")

@説明, ITEMID
#FUNCTIONS
#DIM DYNAMIC ITEMID

SIF DT_CELL_ISNULL("アイテム", ITEMID, "説明")
	RETURNF ""
RETURNF DT_CELL_GETS("アイテム", ITEMID, "説明")

@アイテム削除, ITEMID
#DIM DYNAMIC ITEMID

DT_ROW_REMOVE "アイテム", DT_CELL_GET("アイテム", ITEMID, "id")

@拠点アイテム総数, ARG
#FUNCTION
#DIM DYNAMIC ITEMCOUNT
#DIM DYNAMIC LCOUNT

FOR LCOUNT, 0, DT_ROW_LENGTH("アイテム")
	SIF (DT_CELL_ISNULL("アイテム", LCOUNT, "所有部隊") || DT_CELL_GET("アイテム", LCOUNT, "所持部隊") == 0) && (DT_CELL_ISNULL("アイテム", LCOUNT, "装備中") || DT_CELL_GET("アイテム", LCOUNT, "装備中") == 0)
		ITEMCOUNT++
NEXT

RETURNF ITEMCOUNT

@部隊アイテム総数, 部隊ID
#FUNCTION
#DIM DYNAMIC 部隊ID
#DIM DYNAMIC 総数
#DIM DYNAMIC LCOUNT

FOR LCOUNT, 0, DT_ROW_LENGTH("アイテム")
	SIF 所有部隊(LCOUNT) == 部隊ID
		総数++
NEXT

RETURNF 総数


@部隊アイテム重量, 部隊ID
#FUNCTION
#DIM DYNAMIC 部隊ID
#DIM DYNAMIC 総重量
#DIM DYNAMIC LCOUNT

FOR LCOUNT, 0, DT_ROW_LENGTH("アイテム")
	SIF 所有部隊(LCOUNT) == 部隊ID
		総重量 += 重量(LCOUNT)
NEXT

RETURNF 総重量

@部隊アイテム重量上限, 部隊ID
#FUNCTION
#DIM DYNAMIC 部隊ID
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC 総重量
#DIM DYNAMIC 対象

FOR LCOUNT, 0, 3
	IF 部隊メンバー:部隊ID:LCOUNT
		対象 = GETNUM(部隊メンバー:部隊ID:LCOUNT)
		SIF ステータス:対象:VP == 0
			CONTINUE
		総重量 += 3
		総重量 += ステータス:対象:筋力
	ENDIF
NEXT

RETURNF 総重量

@部隊アイテム表示, 部隊ID
#DIM DYNAMIC LCOUNT
#DIMS DYNAMIC 分類
#DIMS DYNAMIC 装備条件
#DIM DYNAMIC 要求値
#DIMS DYNAMIC 文字色
#DIM DYNAMIC 部隊ID
#DIM DYNAMIC 表示済み
{
#DIMS DYNAMIC 要求項目 =
"必要筋力",
"必要耐久",
"必要知性",
"必要器用",
"必要感覚",
"必要運勢",
}

CALL COLUMNPRINTL ,0, @"□アイテム重量:{部隊アイテム重量(部隊ID)}/{部隊アイテム重量上限(部隊ID)}"

FOR LCOUNT, 0, DT_ROW_LENGTH("アイテム")
	IF 所有部隊(LCOUNT) == 部隊ID
		SELECTCASE レア度(LCOUNT)
			CASE 1
				文字色 = silver
			CASE 2
				文字色 = lime
			CASE 3
				文字色 = deepskyblue
			CASE 4
				文字色 = purple
			CASE IS >= 5
				文字色 = gold
		ENDSELECT
		CALL COLUMNPRINTL, 0, @"[{LCOUNT}] %アイテム名(LCOUNT)%(レア度:{レア度(LCOUNT)} 重量:{重量(LCOUNT)})", 文字色
	ENDIF
NEXT
;CALL COLUMNPRINTL, 0, @"%RETURNSPACE(アイテムページ > 0, "[201] 前ページ")% %RETURNSPACE(DT_ROW_LENGTH("アイテム") > LCOUNT && 拠点アイテム(LCOUNT+1), "[209] 次ページ")%"
IF CRESULT:1 >= 0 && アイテム名(CRESULT:1) != ""
	FOR LCOUNT, 0, VARSIZE("要求項目")
		要求値 = 要求ステータス(CRESULT:1, 要求項目:LCOUNT)
		SIF 要求値
			装備条件 += @"%要求項目:LCOUNT%:{要求値} "
	NEXT
	分類 = %DT_CELL_GETS("アイテム", CRESULT:1, "分類")%
	CALL COLUMNPRINTL, 0, @"□%DT_CELL_GETS("アイテム", CRESULT:1, "名前")%（ID:{CRESULT:1}）"
	CALL COLUMNPRINTL, 0, @"　レア度:{レア度(CRESULT:1)} \@ 分類 == "消耗品" ? 残り使用回数 # 耐久値 \@:{耐久値(CRESULT:1)} 分類:%分類%"
	SIF 装備条件 != ""
		CALL COLUMNPRINTL, 0, @"　%装備条件%"
	CALL COLUMNPRINTL, 0, @"　\@ 攻撃力(CRESULT:1) ? 攻撃力:{攻撃力(CRESULT:1)}%" "% #\@\@ 防御力(CRESULT:1) ? 防御力:{防御力(CRESULT:1)}%" "% #\@\@ 命中率(CRESULT:1) ? 命中率:{命中率(CRESULT:1)}%" "% #\@\@ 特殊効果(CRESULT:1) != "" ? 特殊効果:%特殊効果(CRESULT:1)%%" "% #\@\@ 重量(CRESULT:1) ? 重量:{重量(CRESULT:1)} #\@"
	CALL COLUMNPRINTL, 0, @"　%説明(CRESULT:1)%"
ENDIF

@アイテム使用, ITEMID, 対象
#DIM DYNAMIC ITEMID
#DIM DYNAMIC 対象
